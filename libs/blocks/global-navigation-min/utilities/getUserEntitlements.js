import{getConfig as e}from"../../../utils/utils.js";const o="raw";let r={};const t=(e="en-US")=>[`${e}`,`${e.split("-")[0]};q=0.9`,"en;q=0.8"].join(","),s=e=>e===o?[]:{clouds:{},arrangement_codes:{},fulfilled_codes:{},offer_families:{},offers:{},list:{fulfilled_codes:[]}},a="creative_cloud",n="document_cloud",i="experience_cloud",c=e=>{if(!Array.isArray(e))return s();const{clouds:o,arrangement_codes:r,fulfilled_codes:t,offer_families:c,offers:d,list:l}=s();return e.forEach((({fulfilled_items:e,offer:s={}})=>{const f=s.product_arrangement?.cloud;o[a]=o[a]||"CREATIVE"===f,o[n]=o[n]||"DOCUMENT"===f,o[i]=o[i]||"EXPERIENCE"===f;const u=s.product_arrangement?.family;if(u&&(c[u.toLowerCase()]=!0),s.product_arrangement_code&&(r[s.product_arrangement_code]=!0),Array.isArray(e)&&e.forEach((({code:e})=>{e&&-1===l.fulfilled_codes.indexOf(e)&&(t[e]=!0,l.fulfilled_codes.push(e))})),s.offer_id){const{offer_id:e,...o}=s;d[e]=o}})),{clouds:o,arrangement_codes:r,fulfilled_codes:t,offer_families:c,offers:d,list:l}};export default async({params:a,format:n}={})=>{if(!window.adobeIMS?.isSignedInUser())return r={},Promise.resolve(s(n));const i=(e=>{const o=[];return Array.isArray(e)&&e.length&&e.forEach(((e={})=>{const{name:r,value:t}=e;"string"==typeof r&&r.length&&o.push(`${encodeURIComponent(r)}=${encodeURIComponent(t)}`)})),o.length?`?${o.join("&")}`:""})(a);return r[i]||(r[i]=r[i]||new Promise((o=>{(async({queryParams:o},r)=>{const a=e(),n=await window.adobeIMS.getProfile(),i="prod"===a.env.name?`https://www.adobe.com/aos-api/users/${n.userId}/subscriptions`:`https://www.stage.adobe.com/aos-api/users/${n.userId}/subscriptions`;return await fetch(`${i}${o}`,{method:"GET",cache:"no-cache",credentials:"same-origin",signal:AbortSignal.timeout(1e4),headers:{Authorization:`Bearer ${window.adobeIMS.getAccessToken().token}`,"X-Api-Key":window.adobeIMS.adobeIdData.client_id,"Accept-Language":t(a.locale.ietf)}}).then((e=>200===e.status?e.json():s(r)))})({queryParams:i},n).then((e=>o(e))).catch((()=>o(s(n))))}))),n===o?r[i]:r[i].then((e=>c(e))).catch((()=>s(n)))};